// Vercel 專案 -> /api/analyze.js
// V13.5 最終修正：強制 AI 輸出乾淨的 JSON 結構，絕對禁止任何額外文字。

const OpenAI = require('openai');
// ... (省略前面程式碼) ...

// JSON 結構提示，確保圖表和長條圖所需數據完整
const JSON_STRUCTURE_PROMPT = `
**請絕對、嚴格、立即遵守以下格式規範，這是強制性的最終要求：**

1.  報告主體必須是專業、深入的繁體中文 Markdown 格式。
2.  **在報告結束後，你必須立即輸出一個獨立的 '```json' 程式碼區塊。**
3.  **此 '```json' 區塊的前後，絕對禁止出現任何多餘的解釋文字或標題 (如「以下是JSON輸出」)。**
4.  JSON 區塊必須嚴格包含以下結構：

{
  "scores": {
    "fit": [0-100的整數，代表契合度分數],
    "comm": [0-100的整數，代表溝通度分數],
    "pace": [0-100的整數，代表節奏度分數],
    "account": [0-100的整數，代表權責度分數],
    "trust": [0-100的整數，代表信任度分數],
    "innov": [0-100的整數，代表創新度分數]
  },
  "tags": [
    "性格或情境的關鍵詞1",
    "性格或情境的關鍵詞2",
    "性格或情境的關鍵詞2"
  ]
}
`;

// ... (省略後面的程式碼) ...
