<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>仙人指路神獸七十二型人格｜一鍵分析</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body class="bg-gray-50 min-h-screen">

  <!-- 頁首 -->
  <header class="bg-white shadow p-4 flex items-center justify-between">
    <div>
      <h1 class="text-2xl font-bold">仙人指路神獸七十二型人格｜一鍵分析</h1>
      <p class="text-sm text-gray-500">輸入條件 → 一鍵分析 → 結果顯示分數條 + 雷達圖</p>
    </div>
    <div class="flex gap-2">
      <input type="color" id="bgColor" title="背景顏色" class="w-8 h-8 cursor-pointer">
      <input type="file" id="bgImg" accept="image/*" title="上傳背景圖片" class="cursor-pointer">
    </div>
  </header>

  <main class="p-6 space-y-6">

    <!-- 模式切換 -->
    <div class="flex gap-3">
      <button id="modeSingle" class="px-4 py-2 rounded-lg bg-indigo-600 text-white">單人分析</button>
      <button id="modeDual" class="px-4 py-2 rounded-lg bg-gray-200 text-gray-800">雙人分析</button>
    </div>

    <!-- 我方 & 對方 -->
    <div class="grid md:grid-cols-2 gap-4">
      <!-- 我方 -->
      <section class="bg-white p-4 rounded-lg shadow">
        <h2 class="font-semibold mb-2">我方</h2>
        <select id="aBeast" class="w-full mb-2 border rounded p-2">
          <option value="">六獸</option>
          <option>青龍</option><option>朱雀</option><option>勾陳</option>
          <option>螣蛇</option><option>白虎</option><option>玄武</option>
        </select>
        <select id="aKin" class="w-full mb-2 border rounded p-2">
          <option value="">六親</option>
          <option>父母</option><option>兄弟</option><option>子孫</option>
          <option>妻財</option><option>官鬼</option>
        </select>
        <select id="aBranch" class="w-full border rounded p-2">
          <option value="">地支</option>
          <option>子</option><option>丑</option><option>寅</option><option>卯</option>
          <option>辰</option><option>巳</option><option>午</option><option>未</option>
          <option>申</option><option>酉</option><option>戌</option><option>亥</option>
        </select>
      </section>

      <!-- 對方 -->
      <section id="sectionB" class="bg-white p-4 rounded-lg shadow">
        <h2 class="font-semibold mb-2">對方</h2>
        <select id="bBeast" class="w-full mb-2 border rounded p-2">
          <option value="">六獸</option>
          <option>青龍</option><option>朱雀</option><option>勾陳</option>
          <option>螣蛇</option><option>白虎</option><option>玄武</option>
        </select>
        <select id="bKin" class="w-full mb-2 border rounded p-2">
          <option value="">六親</option>
          <option>父母</option><option>兄弟</option><option>子孫</option>
          <option>妻財</option><option>官鬼</option>
        </select>
        <select id="bBranch" class="w-full border rounded p-2">
          <option value="">地支</option>
          <option>子</option><option>丑</option><option>寅</option><option>卯</option>
          <option>辰</option><option>巳</option><option>午</option><option>未</option>
          <option>申</option><option>酉</option><option>戌</option><option>亥</option>
        </select>
      </section>
    </div>

    <!-- 情境 -->
    <section class="bg-white p-4 rounded-lg shadow">
      <h2 class="font-semibold mb-2">情境</h2>
      <div class="flex flex-wrap gap-2 mb-2">
        <button class="preset px-3 py-1 bg-gray-200 rounded">年度目標協調</button>
        <button class="preset px-3 py-1 bg-gray-200 rounded">績效回饋會議</button>
        <button class="preset px-3 py-1 bg-gray-200 rounded">跨部門協作</button>
        <button class="preset px-3 py-1 bg-gray-200 rounded">壓期交付專案</button>
        <button class="preset px-3 py-1 bg-gray-200 rounded">人際關係協調</button>
        <button class="preset px-3 py-1 bg-gray-200 rounded">愛情</button>
        <button class="preset px-3 py-1 bg-gray-200 rounded">性愛</button>
      </div>
      <input id="context" class="w-full border rounded p-2" placeholder="輸入情境…"/>
      <!-- 性愛模組 -->
      <div id="sexOptions" class="hidden mt-3 p-3 border rounded bg-red-50">
        <div class="flex justify-between items-center mb-2">
          <p class="font-semibold text-red-600">性愛深入分析模組</p>
          <button id="sexSelectAll" class="text-sm px-2 py-1 bg-red-200 rounded">全選</button>
        </div>
        <div class="flex flex-wrap gap-2">
          <label><input type="checkbox" class="sex-detail" value="情愛指數"> 情愛指數</label>
          <label><input type="checkbox" class="sex-detail" value="互動模式"> 互動模式</label>
          <label><input type="checkbox" class="sex-detail" value="雷點分析"> 雷點分析</label>
          <label><input type="checkbox" class="sex-detail" value="劇本推薦"> 劇本推薦</label>
          <label><input type="checkbox" class="sex-detail" value="推薦體位"> 推薦體位</label>
          <label><input type="checkbox" class="sex-detail" value="情趣玩具"> 情趣玩具</label>
          <label><input type="checkbox" class="sex-detail" value="性愛場景"> 性愛場景</label>
        </div>
      </div>
    </section>

    <!-- 動作 -->
    <div class="flex gap-3">
      <button id="analyzeBtn" class="px-4 py-2 bg-indigo-600 text-white rounded">一鍵分析</button>
      <button onclick="window.print()" class="px-4 py-2 bg-gray-200 rounded">列印 / 匯出 PDF</button>
      <span id="status" class="text-sm text-gray-500"></span>
    </div>

    <!-- 結果 -->
    <section id="result" class="bg-white p-5 rounded-lg shadow">
      <p class="text-gray-400">尚未產生分析結果</p>
    </section>
    <div id="chart" class="mt-4"></div>
  </main>

  <script>
    const $ = s => document.querySelector(s);
    const $$ = s => document.querySelectorAll(s);
    let mode = 'dual';

    // 模式切換
    $('#modeSingle').onclick = () => {
      mode = 'single';
      $('#sectionB').style.display = 'none';
      $('#modeSingle').classList.replace('bg-gray-200','bg-indigo-600');
      $('#modeSingle').classList.replace('text-gray-800','text-white');
      $('#modeDual').classList.replace('bg-indigo-600','bg-gray-200');
      $('#modeDual').classList.replace('text-white','text-gray-800');
    };
    $('#modeDual').onclick = () => {
      mode = 'dual';
      $('#sectionB').style.display = 'block';
      $('#modeDual').classList.replace('bg-gray-200','bg-indigo-600');
      $('#modeDual').classList.replace('text-gray-800','text-white');
      $('#modeSingle').classList.replace('bg-indigo-600','bg-gray-200');
      $('#modeSingle').classList.replace('text-white','text-gray-800');
    };

    // 情境按鈕
    $$('.preset').forEach(b => b.onclick = () => {
      $('#context').value = b.textContent;
      toggleSexOptions();
    });
    $('#context').oninput = toggleSexOptions;
    function toggleSexOptions(){
      if($('#context').value.trim()==='性愛'){
        $('#sexOptions').classList.remove('hidden');
      } else {
        $('#sexOptions').classList.add('hidden');
      }
    }

    // 全選
    $('#sexSelectAll').onclick = () => {
      $$('.sex-detail').forEach(cb => cb.checked = true);
    };

    // 背景設定
    $('#bgColor').oninput = e => { document.body.style.background = e.target.value; };
    $('#bgImg').onchange = e => {
      const file = e.target.files[0]; if(!file) return;
      const reader = new FileReader();
      reader.onload = ev => {
        document.body.style.backgroundImage = `url(${ev.target.result})`;
        document.body.style.backgroundSize = 'cover';
        document.body.style.backgroundAttachment = 'fixed';
      };
      reader.readAsDataURL(file);
    };

    // Radar
    let radarChart=null;
    function renderRadar(scores){
      const wrap=$('#chart'); wrap.innerHTML='';
      if(!scores) return;
      const canvas=document.createElement('canvas'); wrap.appendChild(canvas);
      if(radarChart) radarChart.destroy();
      radarChart=new Chart(canvas,{type:'radar',
        data:{labels:['契合','溝通','節奏','權責','信任','創新'],
        datasets:[{label:'六維度雷達圖',data:[
          scores.fit,scores.comm,scores.pace,scores.account,scores.trust,scores.innov],
          fill:true,backgroundColor:'rgba(99,102,241,0.15)',
          borderColor:'rgba(99,102,241,1)',pointBackgroundColor:'rgba(99,102,241,1)'}]},
        options:{scales:{r:{min:0,max:100,ticks:{stepSize:20}}},plugins:{legend:{display:false}}}});
    }

    // 分析
    $('#analyzeBtn').onclick=()=>{
      $('#status').textContent='分析中…';
      setTimeout(()=>{
        const scores={fit:78,comm:70,pace:65,account:72,trust:68,innov:80};
        $('#result').innerHTML=`
          <h3 class="text-lg font-bold mb-2">分析結果</h3>
          <div class="space-y-2">
            ${Object.entries(scores).map(([k,v])=>
              `<div class="flex items-center gap-2 text-sm">
                <b class="w-20">${k}</b>
                <div class="flex-1 bg-gray-200 h-2 rounded"><div class="bg-indigo-500 h-2 rounded" style="width:${v}%;"></div></div>
                <span>${v}</span>
              </div>`).join('')}
          </div>`;
        renderRadar(scores);
        $('#status').textContent='✅ 完成';
      },1000);
    };
  </script>
</body>
</html>
